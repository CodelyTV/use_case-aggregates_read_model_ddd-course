{
	"version": 3,
	"name": "ecommerce-gateway",
	"port": 8080,
	"endpoints": [
		{
			"endpoint": "/shop/products/{id}",
			"method": "GET",
			"backend": [
				{
					"host": [
						"http://host.docker.internal:3000"
					],
					"url_pattern": "/api/shop/products/{id}"
				},
				{
					"host": [
						"http://host.docker.internal:3000"
					],
					"url_pattern": "/api/shop/product_reviews?product_id={id}",
					"is_collection": true,
					"extra_config": {
						"proxy": {
							"flatmap_filter": [
								{ "type": "del", "args": ["collection.*.productId"] },
								{ "type": "del", "args": ["collection.*.id"] },
								{
									"type": "move",
									"args": ["collection", "latestTopReviews"]
								}
							]
						},
						"modifier/jmespath": {
							"@comment": "Only works on enterprise edition",
							"expr": "latestTopReviews[?rating >= `4` ]"
						}
					}
				}
			]
		}
	]
}
